// Copyright (c) 2018 NEC Laboratories Europe GmbH.
//
// Authors: Wenting Li <wenting.li@neclab.eu>
//          Sergey Fedorov <sergey.fedorov@neclab.eu>
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package pb;

enum MessageType {
    UNKNOWN = 0;
    REQUEST = 1;
    REPLY = 2;
    PREPARE = 3;
    COMMIT = 4;
}

message Message{
    oneof typed {
        Request request = 1;
        Reply reply = 2;
        Prepare prepare = 3;
        Commit commit = 4;
    }
}

message Request {
    uint32 client_id = 1; // c: client id
    uint64 seq = 2;       // seq: request sequence per client
    bytes operation = 3;  // op: operation payload
    bytes signature = 4;  // client signature
}

message Reply {
    uint32 replica_id = 1; // s: replica id
    uint32 client_id = 2;  // c: client id
    uint64 seq = 3;        // seq: corresponding request sequence
    bytes result = 4;      // res: result
    bytes signature = 5;   // replica's signature
}

message Prepare {
    uint32 replica_id = 1; // s_i: replica id
    uint64 view = 2;       // v: view
    Request request = 3;   // m: request message
    bytes ui = 4;          // UI_i: replica UI
}

message Commit {
    uint32 replica_id = 1; // s_j: replica id
    Prepare prepare = 2;   // prepare message
    bytes ui = 3;          // UI_j: replica UI
}
